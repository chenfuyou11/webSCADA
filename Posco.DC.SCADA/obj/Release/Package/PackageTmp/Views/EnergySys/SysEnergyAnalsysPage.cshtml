@{ 
    Layout = null;
}
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>能效分析</title>
    <link href="~/Content/ListLayui/static/admin/layui/css/layui.css" rel="stylesheet" />
    <link href="~/Content/ListLayui/static/admin/css/admin.css" rel="stylesheet" />   
    <script src="~/Scripts/jquery-3.3.1.js"></script>
    <script src="~/Content/ListLayui/static/admin/layui/layui.js"></script>
    <script src="~/Content/ListLayui/static/admin/js/common.js"></script>
   
    <style>
        .numTitle{
             width: 90px;
             height: 15px;
             text-align: center;
             border:1px solid white;
             background-color:#2f3545;
             color:white;
        }
         .numTitle3{
             width: 90px;
             height: 15px;
             text-align: center;
             border:1px solid white;
             background-color:#eaeaec;
        }
           .numTitle1{
             width: 90px;
             height: 15px;
             text-align: center;
             border:1px solid white;
             background-color:whitesmoke;
        }
          .numTitle2{
             width: 90px;
             height: 15px;
             text-align: center;
             border:1px solid white;
             background-color:#f25c66;
        }
        .pressTitle{
            width:90px;
            height:30px;
            text-align: center;
             border:1px solid white;
             background-color:#2f3545;
             color:white;
        }
        .pressTitle1{
            width:90px;
            height:30px;
            text-align: center;
             border:1px solid white;
             background-color:white;
             /*color:#00b5f9;*/
             color:#f25c66;
        }
        .setTitle{
             width:90px;
            height:30px;
            text-align: center;
             border:1px solid white;
             background-color:#eaeaec;
        }
        .tipstop {
            text-align: center;
            background-color: #2f2f2f;
            width: 316px;
            height: 58px;
            font-size:20px;
            color:white;
            vertical-align:middle;
             border-radius:5px 5px 0 0;
             line-height:58px;
        }
        .tipsdd{
            width:316px;
            height: 63px;
            background-color: whitesmoke;
        }
        .tipscenter {
            width:316px;
            height: 50px;
            background-color: whitesmoke;
        }
         .tipscenter1 {
            width:316px;
            height: 44px;
            background-color: whitesmoke;
        }
          .tipscenter2 {
            width:316px;
            height: 20px;
            background-color: whitesmoke;
              filter:progid:DXImageTransform.Microsoft.Shadow(color=#909090,direction=120,strength=4);
            -moz-box-shadow: 0 2px 0 #909090;
            -webkit-box-shadow: 0 2px 0 #909090;
            box-shadow: 0 2px 0 #909090;
            border-radius: 0 0 5px 5px;
        }
           .tipswr {
            width:316px;
            background-color: whitesmoke;
            font-size:10px;
            text-align:center;
            color:red
        }
           .tipswr .tipswrc{
               padding-left:15px;
               padding-right:15px;
           }
        .tipstime {
            text-align: center;
            width: 316px;
            background-color: whitesmoke;
            font-size: 10px;
        }
        .mar{
            margin-top:20px;
        }
    </style>
</head>

<body>
    <input type="hidden"value="@ViewBag.onoff" id="hide"/>
    <input type="hidden" value="@ViewBag.datapress" id="valuehide" />
    <div class="layui-tab page-content-wrap">
        <ul class="layui-tab-title">
            <li class="layui-this">开关机设定</li>
            <li>压力设定</li>
        </ul>
        <div class="layui-tab-content">
            <!--开关机设定-->
            <div class="layui-tab-item layui-show" style="height:100%">
                <div id="stackswitch" style="width:40%; float:left">
                </div>
                <div id="tips" class="layui-hide" style="width:35%;float:left;text-align:center">
                    <div style="margin-top:30%;margin-left:30%">


                        <div class="tipstop">可关闭空压机提醒</div>
                        <div class="tipsdd"> </div>
                        <div class="tipscenter">
                            <img src="~/Content/KYJ/images/gantan.png" id="img" style="width:50px;height:50px" />
                        </div>
                        <div class="tipscenter1"></div>
                        <div class="tipswr"><div class="tipswrc"></div></div>
                        <div class="tipscenter1"></div>
                        <div class="tipstime"></div>
                        <div class="tipscenter2"></div>
                    </div>
                </div>
            </div>
            <!--压力设定调整-->
            <div class="layui-tab-item">
                <div style="float:left">
                    <!--空压站1-->
                    <div class="mar">
                        <table>
                            <thead>
                                <tr>
                                    <th class="pressTitle1">空压站一</th>
                                    <th class="pressTitle">基础负载</th>
                                    <th class="pressTitle">二级负载</th>
                                    <th class="pressTitle">三级负载</th>
                                    <th class="pressTitle">四级负载</th>
                                </tr>
                            </thead>
                            <tbody id="t1"></tbody>
                        </table>
                    </div>
                    <!--空压站2-->
                    <div class="mar">
                        <table>
                            <thead>
                                <tr>
                                    <th class="pressTitle1">空压站二</th>
                                    <th class="pressTitle">基础负载</th>
                                    <th class="pressTitle">二级负载</th>
                                    <th class="pressTitle">三级负载</th>
                                    <th class="pressTitle">四级负载</th>
                                </tr>
                            </thead>
                            <tbody id="t2"></tbody>
                        </table>
                    </div>
                    <!--空压站3-->
                    <div class="mar">
                        <table>
                            <thead>
                                <tr>
                                    <th class="pressTitle1">空压站三</th>
                                    <th class="pressTitle">基础负载</th>
                                    <th class="pressTitle">二级负载</th>
                                    <th class="pressTitle">三级负载</th>
                                    <th class="pressTitle">四级负载</th>
                                </tr>
                            </thead>
                            <tbody id="t3"></tbody>
                        </table>
                    </div>
                    <!--空压站4-->
                    <div class="mar">
                        <table>
                            <thead>
                                <tr>
                                    <th class="pressTitle1">空压站四</th>
                                    <th class="pressTitle">基础负载</th>
                                    <th class="pressTitle">二级负载</th>
                                    <th class="pressTitle">三级负载</th>
                                    <th class="pressTitle">四级负载</th>
                                </tr>
                            </thead>
                            <tbody id="t4"></tbody>
                        </table>
                    </div>
                </div>
                <!--定点巡检-->
                <div class="layui-tab-item">
                    <div style="font-size:90px;color:red">
                        敬请期待
                    </div>
                </div>
                <!--空压机IGV和BOV检查-->
            </div>
        </div>    
        </div>
    <script src="~/Scripts/code/highcharts.js"></script>
    <script src="~/Scripts/code/highcharts-more.js"></script>
</body>

</html>
<script>

    $(document).ready(function () {
        layui.use('layer', function () {
            var layer = layui.layer;
            var tip = "";
            //$("#tips").hide();
            function changesize() {
                var height = $(window).height();
                var width = $(window).width();
                var ratioH = height / 867;
                var ratioW = width / 1700;
                $("#stackswitch").css("height", height * ratioH * 0.8 + "px");
                $("#tips").css("height", height * ratioH * 0.8 + "px");
                $("#img").css("height", 50 * ratioH+ "px");
                $("#img").css("width", 50 * ratioW + "px");
                $(".tipstop").css("height", 58 * ratioH + "px");
                $(".tipstop").css("width", 316 * ratioW + "px");
                $(".tipstop").css("line-height", 58 * ratioH + "px");
                $(".tipstop").css("font-size", 20 * ratioH * ratioW + "px");
                $(".tipsdd").css("width", 316 * ratioW + "px");
                $(".tipsdd").css("height", 63 * ratioH + "px");
                $(".tipscenter").css("width", 316 * ratioW + "px");
                $(".tipscenter").css("height", 50 * ratioH + "px");
                $(".tipscenter1").css("width", 316 * ratioW + "px");
                $(".tipscenter1").css("height", 44 * ratioH + "px");
                $(".tipscenter2").css("width", 316 * ratioW + "px");
                $(".tipscenter2").css("height", 20 * ratioH + "px");
                $(".tipswr").css("width", 316 * ratioW + "px");
                $(".tipswr").css("font-size", 10 * ratioW * ratioH + "px");
                $(".tipstime").css("width", 316 * ratioW + "px");
                $(".tipstime").css("font-size", 10 * ratioW * ratioH + "px");
            }
            changesize();
            window.onresize = function () {
                changesize();
            }
            var str = JSON.parse($("#hide").val());
            var usearr = [];
            $.each(str, function (index, item) {
                var tt = [];
                $.each(item, function (i, j) {
                    if (index < 6) {
                        if (j.Run > 0) {
                            tt.push({
                                name: j.Equid + "空压机",
                                y: j.UPI,
                                color: '#58a7dc'
                            })
                        }
                        else {
                            tt.push({
                                name: j.Equid + "空压机",
                                y: j.UPI,
                                color: '#f25c66'
                            })
                        }
                    }
                    else {
                        if (j.Equid != 0) {
                            if (j.Run > 0) {
                                tt.push({
                                    name: j.Equid + "空压机",
                                    y: j.UPI,
                                    color: '#58a7dc'
                                })
                            }
                            else {
                                tt.push({
                                    name: j.Equid + "空压机",
                                    y: j.UPI,
                                    color: '#f25c66'
                                })
                            }
                        }
                        else {
                            tt.push({
                                name: "",
                                y: false,
                            })
                        }
                    }
                })
                usearr.push({
                    name: index + 1 + '',
                    data: tt
                })
            })
            Highcharts.setOptions({
                lang: {
                    printChart: "打印图表",
                    downloadJPEG: "下载JPEG 图片",
                    downloadPDF: "下载PDF文档",
                    downloadPNG: "下载PNG图片",
                    downloadSVG: "下载SVG矢量图",
                    resetZoom: "还原",
                }
            });
            var stackswitchchartt = Highcharts.chart('stackswitch', {
                chart: {
                    type: 'bar',
                },
                title: {
                    text: ''
                },
                subtitle: {
                    text: ''
                },
                xAxis: {
                    categories: ['1站', '2站', '3站', '4站'],
                    title: {
                        text: null
                    },
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: '单耗 (kWh/N㎥)',
                        align: 'high'
                    },
                    labels: {
                        overflow: 'justify'
                    }
                },
                tooltip: {
                    valueSuffix: ' kWh/N㎥'
                },
                plotOptions: {
                    bar: {
                        //x轴的长度*pointpadding，表示两个主之间间隔
                        pointPadding: 0.1,
                        //表示两个x轴点间的间隔
                        groupPadding: 0.02,
                        dataLabels: {
                            enabled: true,
                            //inside:true,
                            allowOverlap: true, // 允许数据标签重叠
                            formatter: function () {
                                var keyx = parseInt(this.key);
                                return keyx + "#:" + this.y;
                            },
                            style: {
                                fontSize: "11px",
                                fontWeight: "bold",
                                textOutline: 'none',
                                color: 'black'
                            }
                        }
                    }
                },
                legend: {
                    enabled: false
                },
                series: usearr
            });
       
        function switchInfo() {
            $.ajax({
                url: "/EnergySys/SysAnalsysSwitchAjax",
                type: "GET",
                success: function (data) {
                    //开关机和能效图
                    if (data.swi.length > 10) {
                        var switchstackres = stackswitchchartt.series;
                        var datares = data.swi;
                        var listarr = [];
                        $.each(switchstackres, function (index, item) {
                            var tt = [];
                            $.each(item.data, function (i, j) {
                                var numj = parseInt(j.name.replace(/[^1-9]/ig, "")) + 6 * i - 1;
                                var indexj = 0;
                                var jcolor = '';
                                if (!isNaN(numj)) {
                                    indexj = numj;
                                    if (datares[indexj] > 0) {
                                        jcolor = '#58a7dc';
                                    }
                                    else {
                                        jcolor = '#f25c66';
                                    }

                                }
                                tt.push({
                                    name: j.name,
                                    y: j.y,
                                    color: jcolor
                                })
                            })
                            listarr.push({
                                name: index + 1 + '',
                                data: tt
                            });
                        })
                        stackswitchchartt.update({
                            series: listarr
                        })
                    }
                    else {
                        var jsonres = data.swi;
                        var usearr = [];
                        $.each(jsonres1, function (index, item) {
                            var tt = [];
                            $.each(item, function (i, j) {
                                if (index < 6) {
                                    if (j.Run > 0) {
                                        tt.push({
                                            name: j.Equid + "空压机",
                                            y: j.UPI,
                                            color: '#58a7dc'
                                        })
                                    }
                                    else {
                                        tt.push({
                                            name: j.Equid + "空压机",
                                            y: j.UPI,
                                            color: '#f25c66'
                                        })
                                    }
                                }
                                else {
                                    if (j.Equid != 0) {
                                        if (j.Run > 0) {
                                            tt.push({
                                                name: j.Equid + "空压机",
                                                y: j.UPI,
                                                color: '#58a7dc'
                                            })
                                        }
                                        else {
                                            tt.push({
                                                name: j.Equid + "空压机",
                                                y: j.UPI,
                                                color: '#f25c66'
                                            })
                                        }
                                    }
                                    else {
                                        tt.push({
                                            name: "",
                                            y: false,
                                        })
                                    }
                                }
                            })
                            usearr.push({
                                name: index + 1 + '',
                                data: tt
                            });
                        })
                        stackswitchchartt.update({
                            series: listarr
                        })
                    }
                    if (data.Onoff > 0) {
                        var usewr = '';
                        $.each(data.OnoffList, function (index, item) {
                            usewr += "空压站" + (item.sta + 1) + "可关闭空压机" + item.cen + "台;";
                        })
                        $(".tipswrc").html(usewr);
                        $(".tipstime").html(data.time);
                        $("#tips").attr("class","layui-show");
                    }
                    else {
                        $("#tips").attr("class","layui-hide");
                    }
                }
            })
        }
        switchInfo();
        setInterval(switchInfo, 6000);
        })
        var valuestr = JSON.parse($("#valuehide").val());
        function presspage(x) {
            var setvalue = x.disarr;
            var numvalue = x.arr;
            var tablehtml = '<tr><td class="pressTitle">启动压力设定</td>';
            var tablehtml1 = '<tr><td class="pressTitle">启动压力设定</td>';
            var tablehtml2 = '<tr><td class="pressTitle">启动压力设定</td>';
            var tablehtml3 = '<tr><td class="pressTitle">启动压力设定</td>';
            var allarr = [];
            $.each(numvalue, function (index, item) {
                var list = [];
                var arr = [];
                var arr1 = [];
                var arr2 = [];
                var arr3 = [];
                var arr4 = [];
                var arr5 = [];
                var arr6 = [];
                if (index < 3) {
                    $.each(item, function (i, j) {
                        if (i < 4) {
                            arr[i] = j
                        }
                        else if (i >= 4 && i < 8) {
                            arr1[i - 4] = j
                        }
                        else if (i >= 8 && i < 12) {
                            arr2[i - 8] = j
                        }
                        else if (i >= 12 && i < 16) {
                            arr3[i - 12] = j
                        }
                        else if (i >= 16 && i < 20) {
                            arr4[i - 16] = j
                        }
                        else if (i >= 20 && i < 24) {
                            arr5[i - 20] = j
                        }
                    })
                    list[0] = arr; list[1] = arr1; list[2] = arr2; list[3] = arr3; list[4] = arr4; list[5] = arr5;
                    allarr[index] = list;
                }
                else {
                    $.each(item, function (i, j) {
                        if (i < 4) {
                            arr[i] = j
                        }
                        else if (i >= 4 && i < 8) {
                            arr1[i - 4] = j
                        }
                        else if (i >= 8 && i < 12) {
                            arr2[i - 8] = j
                        }
                        else if (i >= 12 && i < 16) {
                            arr3[i - 12] = j
                        }
                        else if (i >= 16 && i < 20) {
                            arr4[i - 16] = j
                        }
                        else if (i >= 20 && i < 24) {
                            arr5[i - 20] = j
                        }
                        else {
                            arr6[i - 24] = j;
                        }
                    })
                    list[0] = arr; list[1] = arr1; list[2] = arr2; list[3] = arr3; list[4] = arr4; list[5] = arr5; list[6] = arr6;
                    allarr[index] = list;
                }
            })
            $.each(setvalue, function (index, item) {
                if (index == 0) {
                    $.each(item, function (i, j) {
                        if (j > 0) {
                            tablehtml += '<td class="setTitle">' + j + '</td>';
                        }
                        else {
                            tablehtml += '<td class="setTitle"></td>';
                        }
                    })
                    tablehtml += '</tr>';
                    $.each(allarr[index], function (i, j) {
                        tablehtml += '<tr><td class="numTitle">' + (i + 1) + '</td>';
                        $.each(j, function (ii, jj) {
                            if (item[ii] == jj && jj != 0) {
                                tablehtml += '<td class="numTitle2"></td>';
                            }
                            else {
                                if (i % 2 == 0) {
                                    tablehtml += '<td class="numTitle1"></td>';
                                }
                                else {
                                    tablehtml += '<td class="numTitle3"></td>';
                                }
                            }

                        })
                        tablehtml += '</tr>';
                    })

                }
                else if (index == 1) {
                    $.each(item, function (i, j) {
                        if (j > 0) {
                            tablehtml1 += '<td class="setTitle">' + j + '</td>';
                        }
                        else {
                            tablehtml1 += '<td class="setTitle"></td>';
                        }
                    })
                    tablehtml1 += '</tr>';
                    $.each(allarr[index], function (i, j) {
                        tablehtml1 += '<tr><td class="numTitle">' + (i + 1) + '</td>';
                        $.each(j, function (ii, jj) {
                            if (item[ii] == jj && jj != 0) {
                                tablehtml1 += '<td class="numTitle2"></td>';
                            }
                            else {
                                if (i % 2 == 0) {
                                    tablehtml1 += '<td class="numTitle1"></td>';
                                }
                                else {
                                    tablehtml1 += '<td class="numTitle3"></td>';
                                }
                            }

                        })
                        tablehtml1 += '</tr>';
                    })
                }
                else if (index == 2) {
                    $.each(item, function (i, j) {
                        if (j > 0) {
                            tablehtml2 += '<td class="setTitle">' + j + '</td>';
                        }
                        else {
                            tablehtml2 += '<td class="setTitle"></td>';
                        }
                    })
                    tablehtml2 += '</tr>';
                    $.each(allarr[index], function (i, j) {
                        tablehtml2 += '<tr><td class="numTitle">' + (i + 1) + '</td>';
                        $.each(j, function (ii, jj) {
                            if (item[ii] == jj && jj != 0) {
                                tablehtml2 += '<td class="numTitle2"></td>';
                            }
                            else {
                                if (i % 2 == 0) {
                                    tablehtml2 += '<td class="numTitle1"></td>';
                                }
                                else {
                                    tablehtml2 += '<td class="numTitle3"></td>';
                                }
                            }

                        })
                        tablehtml2 += '</tr>';
                    })
                }
                else {
                    $.each(item, function (i, j) {
                        if (j > 0) {
                            tablehtml3 += '<td class="setTitle">' + j + '</td>';
                        }
                        else {
                            tablehtml3 += '<td class="setTitle"></td>';
                        }
                    })
                    tablehtml1 += '</tr>';
                    $.each(allarr[index], function (i, j) {
                        tablehtml3 += '<tr><td class="numTitle">' + (i + 1) + '</td>';
                        $.each(j, function (ii, jj) {
                            if (item[ii] == jj && jj != 0) {
                                tablehtml3 += '<td class="numTitle2"></td>';
                            }
                            else {
                                if (i % 2 == 0) {
                                    tablehtml3 += '<td class="numTitle1"></td>';
                                }
                                else {
                                    tablehtml3 += '<td class="numTitle3"></td>';
                                };
                            }

                        })
                        tablehtml3 += '</tr>';
                    })
                }
            })
            $("#t1").append(tablehtml);
            $("#t2").append(tablehtml1);
            $("#t3").append(tablehtml2);
            $("#t4").append(tablehtml3);
        }
        presspage(valuestr);
    })
</script>